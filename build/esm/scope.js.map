{"version":3,"file":"scope.js","sources":["../../src/scope.ts"],"sourcesContent":["import { logger } from \"./utils/logger\";\r\nimport { CaptureContext, Extra, Extras, ScopeContext, Scope as ScopeInterface } from \"./index\";\r\nimport { RequestSession, Session } from \"./session\";\r\nimport { Client } from \"./client\";\r\nimport { Event, EventHint, SeverityLevel } from \"./types\";\r\nimport { v4 as uuid4 } from \"uuid\";\r\nimport { isPlainObject } from \"./utils/object\";\r\n\r\nexport interface ScopeData {\r\n  tags: { [key: string]: Primitive };\r\n  extra: Extras;\r\n  sdkProcessingMetadata: { [key: string]: unknown };\r\n  fingerprint: string[];\r\n  level?: SeverityLevel;\r\n  transactionName?: string;\r\n}\r\n\r\nexport type Primitive = number | string | boolean | bigint | symbol | null | undefined;\r\n\r\nexport class Scope implements ScopeInterface {\r\n    /** Flag if notifying is happening. */\r\n    protected _notifyingListeners: boolean;\r\n  \r\n    /** Callback for client to receive scope changes. */\r\n    protected _scopeListeners: Array<(scope: Scope) => void>;\r\n\r\n    protected _level?: SeverityLevel;\r\n  \r\n    /** Tags */\r\n    protected _tags: { [key: string]: Primitive };\r\n  \r\n    /** Extra */\r\n    protected _extra: Extras;\r\n  \r\n    /**\r\n     * A place to stash data which is needed at some point in the SDK's event processing pipeline but which shouldn't get\r\n     * sent to Ribban\r\n     */\r\n    protected _sdkProcessingMetadata: { [key: string]: unknown };\r\n  \r\n    /** Fingerprint */\r\n    protected _fingerprint?: string[];\r\n    /**\r\n     * Transaction Name\r\n     *\r\n     * IMPORTANT: The transaction name on the scope has nothing to do with root spans/transaction objects.\r\n     * It's purpose is to assign a transaction to the scope that's added to non-transaction events.\r\n     */\r\n    protected _transactionName?: string;\r\n  \r\n    /** Session */\r\n    protected _session?: Session;\r\n  \r\n    /** Request Mode Session Status */\r\n    protected _requestSession?: RequestSession;\r\n  \r\n    /** The client on this scope */\r\n    protected _client?: Client;\r\n  \r\n    // NOTE: Any field which gets added here should get added not only to the constructor but also to the `clone` method.\r\n  \r\n    public constructor() {\r\n      this._notifyingListeners = false;\r\n      this._scopeListeners = [];\r\n      this._tags = {};\r\n      this._extra = {};\r\n      this._sdkProcessingMetadata = {};\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public clone(): Scope {\r\n      const newScope = new Scope();\r\n      newScope._tags = { ...this._tags };\r\n      newScope._extra = { ...this._extra };\r\n      newScope._session = this._session;\r\n      newScope._transactionName = this._transactionName;\r\n      newScope._fingerprint = this._fingerprint;\r\n      newScope._requestSession = this._requestSession;\r\n      newScope._sdkProcessingMetadata = { ...this._sdkProcessingMetadata };\r\n      newScope._client = this._client;\r\n    \r\n      return newScope;\r\n    }\r\n  \r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public getClient<C extends Client>(): C | undefined {\r\n      return this._client as C | undefined;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public getRequestSession(): RequestSession | undefined {\r\n      return this._requestSession;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public setRequestSession(requestSession?: RequestSession): this {\r\n      this._requestSession = requestSession;\r\n      return this;\r\n    }\r\n\r\n    addScopeListener(callback: (scope: ScopeInterface) => void): void {\r\n      this._scopeListeners.push(callback);\r\n    }\r\n\r\n    public setClient(client: Client | undefined): void {\r\n        this._client = client;\r\n    }\r\n\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public setTags(tags: { [key: string]: Primitive }): this {\r\n      this._tags = {\r\n        ...this._tags,\r\n        ...tags,\r\n      };\r\n      this._notifyScopeListeners();\r\n      return this;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public setTag(key: string, value: Primitive): this {\r\n      this._tags = { ...this._tags, [key]: value };\r\n      this._notifyScopeListeners();\r\n      return this;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public setExtras(extras: Extras): this {\r\n      this._extra = {\r\n        ...this._extra,\r\n        ...extras,\r\n      };\r\n      this._notifyScopeListeners();\r\n      return this;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public setExtra(key: string, extra: Extra): this {\r\n      this._extra = { ...this._extra, [key]: extra };\r\n      return this;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public setFingerprint(fingerprint: string[]): this {\r\n      this._fingerprint = fingerprint;\r\n      return this;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public setLevel(level: SeverityLevel): this {\r\n      this._level = level;\r\n      this._notifyScopeListeners();\r\n      return this;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public setTransactionName(name?: string): this {\r\n      this._transactionName = name;\r\n      this._notifyScopeListeners();\r\n      return this;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public setSession(session?: Session): this {\r\n      if (!session) {\r\n        delete this._session;\r\n      } else {\r\n        this._session = session;\r\n      }\r\n      this._notifyScopeListeners();\r\n      return this;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public getSession(): Session | undefined {\r\n      return this._session;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public update(captureContext?: CaptureContext): this {\r\n      if (!captureContext) {\r\n        return this;\r\n      }\r\n  \r\n      const scopeToMerge = typeof captureContext === 'function' ? captureContext(this) : captureContext;\r\n  \r\n      const [scopeInstance, requestSession] =\r\n        scopeToMerge instanceof Scope\r\n          ? [scopeToMerge.getScopeData(), scopeToMerge.getRequestSession()]\r\n          : isPlainObject(scopeToMerge)\r\n            ? [captureContext as ScopeContext, (captureContext as ScopeContext).requestSession]\r\n            : [];\r\n  \r\n      const { tags, extra, level, fingerprint = [] } = scopeInstance || {};\r\n  \r\n      this._tags = { ...this._tags, ...tags };\r\n      this._extra = { ...this._extra, ...extra };\r\n  \r\n  \r\n      if (level) {\r\n        this._level = level;\r\n      }\r\n  \r\n      if (fingerprint.length) {\r\n        this._fingerprint = fingerprint;\r\n      }\r\n  \r\n      if (requestSession) {\r\n        this._requestSession = requestSession;\r\n      }\r\n  \r\n      return this;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public clear(): this {\r\n      // client is not cleared here on purpose!\r\n      this._tags = {};\r\n      this._extra = {};\r\n      this._level = undefined;\r\n      this._transactionName = undefined;\r\n      this._fingerprint = undefined;\r\n      this._requestSession = undefined;\r\n      this._session = undefined;\r\n\r\n      this._notifyScopeListeners();\r\n      return this;\r\n    }\r\n\r\n    /** @inheritDoc */\r\n    public getScopeData(): ScopeData {\r\n      return {\r\n        tags: this._tags,\r\n        extra: this._extra,\r\n        level: this._level,\r\n        fingerprint: this._fingerprint || [],\r\n        sdkProcessingMetadata: this._sdkProcessingMetadata,\r\n        transactionName: this._transactionName,\r\n      };\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public setSDKProcessingMetadata(newData: { [key: string]: unknown }): this {\r\n      this._sdkProcessingMetadata = { ...this._sdkProcessingMetadata, ...newData };\r\n  \r\n      return this;\r\n    }\r\n\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public captureException(exception: unknown, hint?: EventHint): string {\r\n      const eventId = hint && hint.event_id ? hint.event_id : uuid4();\r\n  \r\n      if (!this._client) {\r\n        console.warn('No client configured on scope - will not capture exception!');\r\n        return eventId;\r\n      }\r\n  \r\n      const syntheticException = new Error('Ribban syntheticException');\r\n  \r\n      this._client.captureException(\r\n        exception,\r\n        {\r\n          originalException: exception,\r\n          syntheticException,\r\n          ...hint,\r\n          event_id: eventId,\r\n        },\r\n        this,\r\n      );\r\n  \r\n      return eventId;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public captureMessage(message: string, level?: SeverityLevel, hint?: EventHint): string {\r\n      const eventId = hint && hint.event_id ? hint.event_id : uuid4();\r\n  \r\n      if (!this._client) {\r\n        console.warn('No client configured on scope - will not capture message!');\r\n        return eventId;\r\n      }\r\n  \r\n      const syntheticException = new Error(message);\r\n  \r\n      this._client.captureMessage(\r\n        message,\r\n        level,\r\n        {\r\n          originalException: message,\r\n          syntheticException,\r\n          ...hint,\r\n          event_id: eventId,\r\n        },\r\n        this,\r\n      );\r\n  \r\n      return eventId;\r\n    }\r\n  \r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    public captureEvent(event: Event, hint?: EventHint): string {\r\n      const eventId = hint && hint.event_id ? hint.event_id : uuid4();\r\n  \r\n      if (!this._client) {\r\n        console.warn('No client configured on scope - will not capture event!');\r\n        return eventId;\r\n      }\r\n  \r\n      this._client.captureEvent(event, { ...hint, event_id: eventId }, this);\r\n  \r\n      return eventId;\r\n    }\r\n  \r\n    /**\r\n     * This will be called on every set call.\r\n     */\r\n    protected _notifyScopeListeners(): void {\r\n      // We need this check for this._notifyingListeners to be able to work on scope during updates\r\n      // If this check is not here we'll produce endless recursion when something is done with the scope\r\n      // during the callback.\r\n      if (!this._notifyingListeners) {\r\n        this._notifyingListeners = true;\r\n        this._scopeListeners.forEach(callback => {\r\n          callback(this);\r\n        });\r\n        this._notifyingListeners = false;\r\n      }\r\n    }\r\n}\r\n"],"names":["uuid4"],"mappings":"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"}