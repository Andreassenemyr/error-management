{"version":3,"file":"index.js","sources":["../../../../src/node/sdk/index.ts"],"sourcesContent":["import { Client } from \"../../client\";\r\nimport { getCurrentScope } from \"../../current-scopes\";\r\nimport { stackParserFromStackParserOptions } from \"../../types/stacktrace\";\r\nimport { logger } from \"../../utils/logger\";\r\nimport { dropUndefinedKeys } from \"../../utils/object\";\r\nimport { makeNodeTransport } from \"../transports\";\r\nimport { NodeClientOptions, NodeOptions } from \"../types\";\r\nimport { defaultStackParser } from \"./api\";\r\nimport { NodeClient } from \"./client\";\r\n\r\n/**\r\n * Initialize Sentry for Node, without any integrations added by default.\r\n */\r\nexport function init(options: NodeOptions | undefined = {}): void {\r\n    return _init(options);\r\n}\r\n\r\nfunction _init(\r\n    options: NodeOptions | undefined = {}\r\n): void {\r\n    const clientOptions = getClientOptions(options);\r\n\r\n    if (clientOptions.debug === true) {\r\n        logger.enable();\r\n    }\r\n\r\n    const scope = getCurrentScope();\r\n    scope.update(options.initialScope);\r\n\r\n    const client = new NodeClient(clientOptions);\r\n    getCurrentScope().setClient(client);\r\n\r\n    if (isEnabled(client)) {\r\n        client.init();\r\n    }\r\n\r\n    if (options.autoSessionTracking) {\r\n        startSessionTracking();\r\n    }\r\n}\r\n\r\nfunction getClientOptions(options: NodeOptions): NodeClientOptions {\r\n    const release = '1.0.0';\r\n\r\n    const autoSessionTracking =\r\n        typeof release !== 'string'\r\n            ? false\r\n            : options.autoSessionTracking === undefined\r\n                ? true\r\n                : options.autoSessionTracking;\r\n\r\n    const tracesSampleRate = getTracesSampleRate(options.tracesSampleRate);\r\n\r\n    const baseOptions = dropUndefinedKeys({\r\n        transport: makeNodeTransport,\r\n        dsn: process.env.SENTRY_DSN,\r\n        environment: process.env.SENTRY_ENVIRONMENT,\r\n    });\r\n\r\n    const overwriteOptions = dropUndefinedKeys({\r\n        release,\r\n        autoSessionTracking,\r\n        tracesSampleRate,\r\n    });\r\n\r\n    const mergedOptions = {\r\n        ...baseOptions,\r\n        ...options,\r\n        ...overwriteOptions,\r\n    };\r\n\r\n    const clientOptions: NodeClientOptions = {\r\n        ...mergedOptions,\r\n        stackParser: stackParserFromStackParserOptions(options.stackParser || defaultStackParser),\r\n    };\r\n\r\n    return clientOptions;\r\n}\r\n\r\nfunction getTracesSampleRate(tracesSampleRate: NodeOptions['tracesSampleRate']): number | undefined {\r\n    if (tracesSampleRate !== undefined) {\r\n        return tracesSampleRate;\r\n    }\r\n\r\n    const sampleRateFromEnv = process.env.SENTRY_TRACES_SAMPLE_RATE;\r\n    if (!sampleRateFromEnv) {\r\n        return undefined;\r\n    }\r\n\r\n    const parsed = parseFloat(sampleRateFromEnv);\r\n    return isFinite(parsed) ? parsed : undefined;\r\n}\r\n\r\nfunction isEnabled(client: Client): boolean {\r\n    return client.getOptions().enabled !== false && client.getTransport() !== undefined;\r\n}\r\n\r\nfunction startSessionTracking(): void {\r\n\r\n};"],"names":[],"mappings":";;;;;;;;AAUA;AACA;AACA;AACO,SAAS,IAAI,CAAC,OAAO,GAA4B,EAAE,EAAQ;AAClE,IAAI,OAAO,KAAK,CAAC,OAAO,CAAC,CAAA;AACzB,CAAA;;AAEA,SAAS,KAAK;AACd,IAAI,OAAO,GAA4B,EAAC;AACxC,EAAQ;AACR,IAAI,MAAM,aAAc,GAAE,gBAAgB,CAAC,OAAO,CAAC,CAAA;;AAEnD,IAAI,IAAI,aAAa,CAAC,KAAM,KAAI,IAAI,EAAE;AACtC,QAAQ,MAAM,CAAC,MAAM,EAAE,CAAA;AACvB,KAAI;;AAEJ,IAAI,MAAM,KAAA,GAAQ,eAAe,EAAE,CAAA;AACnC,IAAI,KAAK,CAAC,MAAM,CAAC,OAAO,CAAC,YAAY,CAAC,CAAA;;AAEtC,IAAI,MAAM,MAAO,GAAE,IAAI,UAAU,CAAC,aAAa,CAAC,CAAA;AAChD,IAAI,eAAe,EAAE,CAAC,SAAS,CAAC,MAAM,CAAC,CAAA;;AAEvC,IAAI,IAAI,SAAS,CAAC,MAAM,CAAC,EAAE;AAC3B,QAAQ,MAAM,CAAC,IAAI,EAAE,CAAA;AACrB,KAAI;;AAEJ,IAAI,IAAI,OAAO,CAAC,mBAAmB,EAAE,CAEjC;AACJ,CAAA;;AAEA,SAAS,gBAAgB,CAAC,OAAO,EAAkC;AACnE,IAAI,MAAM,OAAQ,GAAE,OAAO,CAAA;;AAE3B,IAAI,MAAM,mBAAoB;AAC9B,QAEc,OAAO,CAAC,mBAAA,KAAwB,SAAA;AAC9C,kBAAkB,IAAA;AAClB,kBAAkB,OAAO,CAAC,mBAAmB,CAAA;;AAE7C,IAAI,MAAM,mBAAmB,mBAAmB,CAAC,OAAO,CAAC,gBAAgB,CAAC,CAAA;;AAE1E,IAAI,MAAM,WAAA,GAAc,iBAAiB,CAAC;AAC1C,QAAQ,SAAS,EAAE,iBAAiB;AACpC,QAAQ,GAAG,EAAE,OAAO,CAAC,GAAG,CAAC,UAAU;AACnC,QAAQ,WAAW,EAAE,OAAO,CAAC,GAAG,CAAC,kBAAkB;AACnD,KAAK,CAAC,CAAA;;AAEN,IAAI,MAAM,gBAAA,GAAmB,iBAAiB,CAAC;AAC/C,QAAQ,OAAO;AACf,QAAQ,mBAAmB;AAC3B,QAAQ,gBAAgB;AACxB,KAAK,CAAC,CAAA;;AAEN,IAAI,MAAM,gBAAgB;AAC1B,QAAQ,GAAG,WAAW;AACtB,QAAQ,GAAG,OAAO;AAClB,QAAQ,GAAG,gBAAgB;AAC3B,KAAK,CAAA;;AAEL,IAAI,MAAM,aAAa,GAAsB;AAC7C,QAAQ,GAAG,aAAa;AACxB,QAAQ,WAAW,EAAE,iCAAiC,CAAC,OAAO,CAAC,WAAA,IAAe,kBAAkB,CAAC;AACjG,KAAK,CAAA;;AAEL,IAAI,OAAO,aAAa,CAAA;AACxB,CAAA;;AAEA,SAAS,mBAAmB,CAAC,gBAAgB,EAAuD;AACpG,IAAI,IAAI,gBAAiB,KAAI,SAAS,EAAE;AACxC,QAAQ,OAAO,gBAAgB,CAAA;AAC/B,KAAI;;AAEJ,IAAI,MAAM,iBAAkB,GAAE,OAAO,CAAC,GAAG,CAAC,yBAAyB,CAAA;AACnE,IAAI,IAAI,CAAC,iBAAiB,EAAE;AAC5B,QAAQ,OAAO,SAAS,CAAA;AACxB,KAAI;;AAEJ,IAAI,MAAM,MAAO,GAAE,UAAU,CAAC,iBAAiB,CAAC,CAAA;AAChD,IAAI,OAAO,QAAQ,CAAC,MAAM,IAAI,MAAA,GAAS,SAAS,CAAA;AAChD,CAAA;;AAEA,SAAS,SAAS,CAAC,MAAM,EAAmB;AAC5C,IAAI,OAAO,MAAM,CAAC,UAAU,EAAE,CAAC,OAAA,KAAY,KAAA,IAAS,MAAM,CAAC,YAAY,EAAC,KAAM,SAAS,CAAA;AACvF;;;;"}