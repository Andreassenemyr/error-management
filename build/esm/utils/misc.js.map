{"version":3,"file":"misc.js","sources":["../../../src/utils/misc.ts"],"sourcesContent":["import { Event } from \"../types\";\nimport { Exception } from \"../types/exception\";\nimport { Mechanism } from \"../types/mechanism\";\nimport { logger } from \"./logger\";\nimport { addNonEnumerableProperty, isRegExp, isString } from \"./object\";\n\nexport function checkOrSetAlreadyCaught(exception: unknown) {\n    if (exception && (exception as any).__ribban_captured__) {\n        return true;\n    };\n\n    try {\n        addNonEnumerableProperty(exception as { [key: string]: unknown }, '__ribban_captured__', true)\n    } catch (error) {\n\n    };\n\n    return false;\n}\n\nexport function isMatchingPattern(\n    value: string,\n    pattern: RegExp | string,\n    requireExactStringMatch: boolean = false,\n): boolean {\n    if (!isString(value)) {\n        return false;\n    }\n\n    if (isRegExp(pattern)) {\n        return pattern.test(value);\n    }\n    \n    if (isString(pattern)) {\n        return requireExactStringMatch ? value === pattern : value.includes(pattern);\n    }\n\n    return false;\n}\n\n\nexport function stringMatchesSomePattern(\n    testString: string,\n    patterns: Array<string | RegExp> = [],\n    requireExactStringMatch: boolean = false,\n): boolean {\n    return patterns.some(pattern => isMatchingPattern(testString, pattern, requireExactStringMatch));\n}\n\nexport function parseSampleRate(sampleRate: unknown): number | undefined {\n    if (typeof sampleRate === 'boolean') {\n        return Number(sampleRate);\n    }\n\n    const rate = typeof sampleRate === 'string' ? parseFloat(sampleRate) : sampleRate;\n    if (typeof rate !== 'number' || isNaN(rate)) {\n        logger.warn(\n            `[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(\n                sampleRate,\n            )} of type ${JSON.stringify(typeof sampleRate)}.`,\n        );\n\n        return undefined;\n    }\n\n    if (rate < 0 || rate > 1) {\n        logger.warn(`[Tracing] Given sample rate is invalid. Sample rate must be between 0 and 1. Got ${rate}.`);\n        return undefined;\n    }\n\n    return rate;\n}\n\nexport function addExceptionTypeValue(event: Event, value?: string, type?: string): void {\n    const exception = (event.exception = event.exception || {});\n    const values = (exception.values = exception.values || []);\n    const firstException = (values[0] = values[0] || {});\n    if (!firstException.value) {\n        firstException.value = value || '';\n    }\n    if (!firstException.type) {\n        firstException.type = type || 'Error';\n    }\n}\n\nfunction getFirstException(event: Event): Exception | undefined {\n    return event.exception && event.exception.values ? event.exception.values[0] : undefined;\n}\n\nexport function addExceptionMechanism(event: Event, newMechanism?: Partial<Mechanism>): void {\n    const firstException = getFirstException(event);\n    if (!firstException) {\n        return;\n    }\n\n    const defaultMechanism = { type: 'generic', handled: true };\n    const currentMechanism = firstException.mechanism;\n    firstException.mechanism = { ...defaultMechanism, ...currentMechanism, ...newMechanism };\n\n    if (newMechanism && 'data' in newMechanism) {\n        const mergedData = { ...(currentMechanism && currentMechanism.data), ...newMechanism.data };\n        firstException.mechanism.data = mergedData;\n    }\n}\n"],"names":[],"mappings":"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"}