{"version":3,"file":"object.js","sources":["../../../src/utils/object.ts"],"sourcesContent":["import { Primitive } from \"../scope\";\nimport { PolymorphicEvent } from \"../types/polymorhics\";\nimport { htmlTreeAsString } from \"./browser\";\nimport { logger } from \"./logger\";\n\nexport function dropUndefinedKeys<T>(inputValue: T): T {\n    const memoizationMap = new Map<unknown, unknown>();\n\n    return dropUndefinedKeysInner(inputValue, memoizationMap);\n};\n\nfunction dropUndefinedKeysInner<T>(inputValue: T, memoizationMap: Map<unknown, unknown>): T {\n    if (isRecord(inputValue)) {\n        const memoValue = memoizationMap.get(inputValue);\n        if (memoValue !== undefined) {\n            return memoValue as T;\n        };\n        \n        const returnValue: { [key: string]: unknown } = {};\n        memoizationMap.set(inputValue, returnValue);\n\n        for (const key of Object.keys(inputValue)) {\n            if (typeof inputValue[key] !== undefined) {\n                returnValue[key] = dropUndefinedKeysInner(inputValue[key], memoizationMap);\n            }\n        }\n\n        return returnValue as T;\n    }\n\n    if (Array.isArray(inputValue)) {\n        const memoValue = memoizationMap.get(inputValue);\n        if (memoValue !== undefined) {\n            return memoValue as T;\n        };\n\n        const returnValue: unknown[] = [];\n        memoizationMap.set(inputValue, returnValue);\n\n        inputValue.forEach((item: unknown) => {\n            returnValue.push(dropUndefinedKeysInner(item, memoizationMap)); \n        })\n\n        return returnValue as unknown as T;\n    };\n\n    return inputValue;\n};\n\nexport function isDOMException(wat: unknown): boolean {\n    return isBuiltin(wat, 'DOMException');\n}\n\nexport function isDOMError(wat: unknown): boolean {\n    return isBuiltin(wat, 'DOMError');\n}\n\nfunction isRecord(input: unknown): input is Record<string, unknown> {\n    if (!isPlainObject(input)) {\n        return false;\n    }\n  \n    try {\n        const name = (Object.getPrototypeOf(input) as { constructor: { name: string } }).constructor.name;\n        return !name || name === 'Object';\n    } catch {\n        return true;\n    }\n};\n\nconst objectToString = Object.prototype.toString;\n\nfunction isBuiltin(wat: unknown, className: string): boolean {\n    return objectToString.call(wat) === `[object ${className}]`;\n};\n  \n\nexport function isPlainObject(wat: unknown): wat is Record<string, unknown> {\n    return isBuiltin(wat, 'Object');\n};\n\nexport function addNonEnumerableProperty(obj: object, name: string, value: unknown): void {\n    try {\n        Object.defineProperty(obj, name, {\n            // enumerable: false, // the default, so we can save on bundle size by not explicitly setting it\n            value: value,\n            writable: true,\n            configurable: true,\n        });\n    } catch (o_O) {\n        logger.log(`Failed to add non-enumerable property \"${name}\" to object`, obj);\n    }\n}\n\nexport function isPrimitive(wat: unknown): wat is Primitive {\n    return wat === null || (typeof wat !== 'object' && typeof wat !== 'function');\n}\n\nexport function isError(wat: unknown): wat is Error {\n    switch (objectToString.call(wat)) {\n        case '[object Error]':\n        case '[object Exception]':\n        case '[object DOMException]':\n            return true;\n        default:\n            return isInstanceOf(wat, Error);\n    }\n}\n\nexport function isInstanceOf(wat: any, base: any): boolean {\n    try {\n        return wat instanceof base;\n    } catch (_e) {\n        return false;\n    }\n}\n\nexport function isRegExp(wat: unknown): wat is RegExp {\n    return isBuiltin(wat, 'RegExp');\n}\n  \n\nexport function extractExceptionKeysForMessage(exception: Record<string, unknown>, maxLength: number = 40): string {\n    const keys = Object.keys(convertToPlainObject(exception));\n    keys.sort();\n  \n    if (!keys.length) {\n        return '[object has no keys]';\n    }\n  \n    if (keys[0].length >= maxLength) {\n        return keys[0].substring(0, maxLength);\n    }\n  \n    for (let includedKeys = keys.length; includedKeys > 0; includedKeys--) {\n        const serialized = keys.slice(0, includedKeys).join(', ');\n        if (serialized.length > maxLength) {\n            continue;\n        }\n        if (includedKeys === keys.length) {\n            return serialized;\n        }\n        return serialized.substring(0, maxLength);\n    }\n  \n    return '';\n}\n\nexport function convertToPlainObject<V>(value: V):\n    | {\n        [ownProps: string]: unknown;\n        type: string;\n        target: string;\n        currentTarget: string;\n        detail?: unknown;\n      }\n    | {\n        [ownProps: string]: unknown;\n        message: string;\n        name: string;\n        stack?: string;\n      }\n    | V {\n    if (isError(value)) {\n        return {\n            message: value.message,\n            name: value.name,\n            stack: value.stack,\n            ...getOwnProperties(value),\n        };\n    } else if (isEvent(value)) {\n        const newObj: {\n          [ownProps: string]: unknown;\n          type: string;\n          target: string;\n          currentTarget: string;\n          detail?: unknown;\n        } = {\n          type: value.type,\n          target: serializeEventTarget(value.target),\n          currentTarget: serializeEventTarget(value.currentTarget),\n          ...getOwnProperties(value),\n        };\n      \n        if (typeof CustomEvent !== 'undefined' && isInstanceOf(value, CustomEvent)) {\n          newObj.detail = value.detail;\n        }\n      \n        return newObj;\n    } else {\n      return value;\n    }\n}\n\nfunction getOwnProperties(obj: unknown): { [key: string]: unknown } {\n    if (typeof obj === 'object' && obj !== null) {\n        const extractedProps: { [key: string]: unknown } = {};\n        for (const property in obj) {\n            if (Object.prototype.hasOwnProperty.call(obj, property)) {\n                extractedProps[property] = (obj as Record<string, unknown>)[property];\n            }\n        }\n        return extractedProps;\n    } else {\n        return {};\n    }\n}\n\nfunction serializeEventTarget(target: unknown): string {\n    try {\n        return isElement(target) ? htmlTreeAsString(target) : Object.prototype.toString.call(target);\n    } catch (_oO) {\n        return '<unknown>';\n    }\n}\n\n/**\n * Checks whether given value's type is an Element instance\n * {@link isElement}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nexport function isElement(wat: unknown): boolean {\n    return typeof Element !== 'undefined' && isInstanceOf(wat, Element);\n}\n  \n\n\n/**\n * Checks whether given value's type is ErrorEvent\n * {@link isErrorEvent}.\n *\n * @param wat A value to be checked.\n * @returns A boolean representing the result.\n */\nexport function isErrorEvent(wat: unknown): boolean {\n    return isBuiltin(wat, 'ErrorEvent');\n}  \n\nexport function isString(wat: unknown): wat is string {\n    return isBuiltin(wat, 'String');\n}\n\nexport function isEvent(wat: unknown): wat is PolymorphicEvent {\n    return typeof Event !== 'undefined' && isInstanceOf(wat, Event);\n}\n\n  \n"],"names":[],"mappings":"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"}