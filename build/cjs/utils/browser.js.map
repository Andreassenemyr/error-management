{"version":3,"file":"browser.js","sources":["../../../src/utils/browser.ts"],"sourcesContent":["import { GLOBAL_OBJ } from \"../worldwide\";\r\nimport { isString } from \"./object\";\r\n\r\nconst WINDOW = GLOBAL_OBJ as unknown as Window;\r\n\r\nconst DEFAULT_MAX_STRING_LENGTH = 80;\r\n\r\ntype SimpleNode = {\r\n  parentNode: SimpleNode;\r\n} | null;\r\n\r\n\r\nexport function htmlTreeAsString(\r\n    elem: unknown,\r\n    options: string[] | { keyAttrs?: string[]; maxStringLength?: number } = {},\r\n): string {\r\n    if (!elem) {\r\n        return '<unknown>';\r\n    }\r\n  \r\n    // try/catch both:\r\n    // - `htmlTreeAsString` because it's complex, and just accessing the DOM incorrectly\r\n    // - can throw an exception in some circumstances.\r\n    try {\r\n        let currentElem = elem as SimpleNode;\r\n        const MAX_TRAVERSE_HEIGHT = 5;\r\n        const out: string[] = [];\r\n        let height = 0;\r\n        let len = 0;\r\n        const separator = ' > ';\r\n        const sepLength = separator.length;\r\n        let nextStr;\r\n        const keyAttrs = Array.isArray(options) ? options : options.keyAttrs;\r\n        const maxStringLength = (!Array.isArray(options) && options.maxStringLength) || DEFAULT_MAX_STRING_LENGTH;\r\n        \r\n        while (currentElem && height++ < MAX_TRAVERSE_HEIGHT) {\r\n            nextStr = _htmlElementAsString(currentElem, keyAttrs);\r\n            // bail out if\r\n            // - nextStr is the 'html' element\r\n                // - the length of the string that would be created exceeds maxStringLength\r\n                //   (ignore this limit if we are on the first iteration)\r\n                if (nextStr === 'html' || (height > 1 && len + out.length * sepLength + nextStr.length >= maxStringLength)) {\r\n                  break;\r\n                }\r\n          \r\n                out.push(nextStr);\r\n          \r\n            len += nextStr.length;\r\n            currentElem = currentElem.parentNode;\r\n        }\r\n      \r\n        return out.reverse().join(separator);\r\n    } catch (_oO) {\r\n        return '<unknown>';\r\n    }\r\n}\r\n\r\nfunction _htmlElementAsString(el: unknown, keyAttrs?: string[]): string {\r\n    const elem = el as {\r\n      tagName?: string;\r\n      id?: string;\r\n      className?: string;\r\n      getAttribute(key: string): string;\r\n    };\r\n  \r\n    const out: string[] = [];\r\n    let className;\r\n    let classes;\r\n    let key;\r\n    let attr;\r\n    let i;\r\n  \r\n    if (!elem || !elem.tagName) {\r\n        return '';\r\n    }\r\n  \r\n    // @ts-expect-error WINDOW has HTMLElement\r\n    if (WINDOW.HTMLElement) {\r\n        // If using the component name annotation plugin, this value may be available on the DOM node\r\n        if (elem instanceof HTMLElement && elem.dataset) {\r\n            if (elem.dataset['ribbanComponent']) {\r\n                return elem.dataset['ribbanComponent'];\r\n            }\r\n            \r\n            if (elem.dataset['ribbanElement']) {\r\n                return elem.dataset['ribbanElement'];\r\n            }\r\n        }\r\n    }\r\n  \r\n    out.push(elem.tagName.toLowerCase());\r\n  \r\n    // Pairs of attribute keys defined in `serializeAttribute` and their values on element.\r\n    const keyAttrPairs =\r\n      keyAttrs && keyAttrs.length\r\n        ? keyAttrs.filter(keyAttr => elem.getAttribute(keyAttr)).map(keyAttr => [keyAttr, elem.getAttribute(keyAttr)])\r\n        : null;\r\n  \r\n    if (keyAttrPairs && keyAttrPairs.length) {\r\n      keyAttrPairs.forEach(keyAttrPair => {\r\n        out.push(`[${keyAttrPair[0]}=\"${keyAttrPair[1]}\"]`);\r\n      });\r\n    } else {\r\n        if (elem.id) {\r\n            out.push(`#${elem.id}`);\r\n        }\r\n      \r\n        className = elem.className;\r\n        if (className && isString(className)) {\r\n            classes = className.split(/\\s+/);\r\n            for (i = 0; i < classes.length; i++) {\r\n                out.push(`.${classes[i]}`);\r\n            }\r\n        }\r\n    }\r\n\r\n    const allowedAttrs = ['aria-label', 'type', 'name', 'title', 'alt'];\r\n    for (i = 0; i < allowedAttrs.length; i++) {\r\n        key = allowedAttrs[i];\r\n        attr = elem.getAttribute(key);\r\n        if (attr) {\r\n            out.push(`[${key}=\"${attr}\"]`);\r\n        }\r\n    }\r\n    return out.join('');\r\n}\r\n  "],"names":["GLOBAL_OBJ","isString"],"mappings":"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"}