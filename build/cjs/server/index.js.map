{"version":3,"file":"index.js","sources":["../../../src/server/index.ts"],"sourcesContent":["import { getVercelEnv } from '../common/getVercelEnv';\r\nimport { isBuild } from '../common/isBuild';\r\nimport { getClient } from '../current-scopes';\r\nimport { NodeOptions } from '../node/types';\r\nimport { logger } from '../utils/logger';\r\nimport { GLOBAL_OBJ } from '../worldwide';\r\nimport { init as nodeInit } from \"../node\"\r\n\r\nexport { withRibbanConfig } from '../config';\r\n\r\nconst globalWithInjectedValues = GLOBAL_OBJ as typeof GLOBAL_OBJ & {\r\n    __rewriteFramesDistDir__?: string;\r\n    __ribbanRewritesTunnelPath__?: string;\r\n};\r\n\r\nconst NEXTJS_SPAN_NAME_PREFIXES = [\r\n    'BaseServer.',\r\n    'LoadComponents.',\r\n    'NextServer.',\r\n    'createServer.',\r\n    'startServer.',\r\n    'NextNodeServer.',\r\n    'Render.',\r\n    'AppRender.',\r\n    'Router.',\r\n    'Node.',\r\n    'AppRouteRouteHandlers.',\r\n    'ResolveMetadata.',\r\n];\r\n\r\n\r\nexport function init(options: NodeOptions) {\r\n    if (isBuild()) {\r\n        return;\r\n    }\r\n\r\n    const newOptions: NodeOptions = {\r\n        environment: getVercelEnv(false) || process.env.NODE_ENV,\r\n        ...options,\r\n        autoSessionTracking: false\r\n    };\r\n\r\n    if (options.debug) {\r\n        logger.enable();\r\n    }\r\n\r\n    logger.log('Initializing Ribban o0.');\r\n\r\n    if (sdkAlreadyInitialized()) {\r\n        logger.log('SDK already initialized. Skipping initialization.');\r\n        return;\r\n    }\r\n    \r\n    nodeInit(newOptions);\r\n\r\n    const client = getClient();\r\n\r\n    logger.log('Ribban o0 initialized.');\r\n};\r\n\r\nfunction sdkAlreadyInitialized(): boolean {\r\n    return !!getClient();\r\n}\r\n\r\nexport * from '../node/types';\r\nexport * from '../index';\r\n"],"names":["isBuild","getVercelEnv","logger","nodeInit","getClient"],"mappings":";;;;;;;;;;;;;;;;;;;;;AA+BO,SAAS,IAAI,CAAC,OAAO,EAAe;AAC3C,IAAI,IAAIA,eAAO,EAAE,EAAE;AACnB,QAAQ,OAAM;AACd,KAAI;;AAEJ,IAAI,MAAM,UAAU,GAAgB;AACpC,QAAQ,WAAW,EAAEC,yBAAY,CAAC,KAAK,CAAE,IAAG,OAAO,CAAC,GAAG,CAAC,QAAQ;AAChE,QAAQ,GAAG,OAAO;AAClB,QAAQ,mBAAmB,EAAE,KAAA;AAC7B,KAAK,CAAA;;AAEL,IAAI,IAAI,OAAO,CAAC,KAAK,EAAE;AACvB,QAAQC,aAAM,CAAC,MAAM,EAAE,CAAA;AACvB,KAAI;;AAEJ,IAAIA,aAAM,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAA;;AAEzC,IAAI,IAAI,qBAAqB,EAAE,EAAE;AACjC,QAAQA,aAAM,CAAC,GAAG,CAAC,mDAAmD,CAAC,CAAA;AACvE,QAAQ,OAAM;AACd,KAAI;;AAEJ,IAAIC,YAAQ,CAAC,UAAU,CAAC,CAAA;;AAExB,IAAmBC,uBAAS,GAAE;;AAE9B,IAAIF,aAAM,CAAC,GAAG,CAAC,wBAAwB,CAAC,CAAA;AACxC;AAEA,SAAS,qBAAqB,GAAY;AAC1C,IAAI,OAAO,CAAC,CAACE,uBAAS,EAAE,CAAA;AACxB;;;;;;;;"}